{"ast":null,"code":"var _jsxFileName = \"/Users/Anna/Dcard/src/App.js\";\nimport styled from 'styled-components';\nimport List from './List';\nimport { Component } from 'react';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst StyledApp = styled.div`\n  background-color: rgb(0, 50, 78);\n  min-height: 100vh;\n  padding: 50px;\n`;\n_c = StyledApp;\n\nclass App extends Component {\n  constructor(props) {\n    var _this;\n\n    super(props);\n    _this = this;\n\n    this.getPosts = function () {\n      let postId = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n      const {\n        data\n      } = _this.state;\n      axios.get(`/posts?popular=true${!!postId ? '&before=' + postId : ''}`).then(_ref => {\n        let {\n          data: apiData\n        } = _ref;\n\n        _this.setState({\n          data: data.concat(apiData),\n          lastId: apiData[apiData.length - 1].id\n        });\n      }).catch(() => {\n        console.log('fail');\n      });\n    };\n\n    this.onScrollHandle = () => {\n      const {\n        lastId\n      } = this.state;\n      const clientHeight = document.documentElement.clientHeight;\n      const scrollHeight = document.documentElement.scrollHeight;\n      const scrollTop = document.documentElement.scrollTop;\n      const isBottom = clientHeight + scrollTop === scrollHeight;\n\n      if (isBottom && lastId) {\n        this.getPosts(lastId);\n      }\n    };\n\n    this.state = {\n      data: [],\n      lastId: null\n    };\n  }\n\n  async componentDidMount() {\n    window.addEventListener('scroll', this.onScrollHandle);\n    await this.getPosts();\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('scroll', this.onScrollHandle);\n  }\n\n  render() {\n    const {\n      data\n    } = this.state;\n    return /*#__PURE__*/_jsxDEV(StyledApp, {\n      children: /*#__PURE__*/_jsxDEV(List, {\n        data: data\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 65,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"StyledApp\");","map":{"version":3,"sources":["/Users/Anna/Dcard/src/App.js"],"names":["styled","List","Component","axios","StyledApp","div","App","constructor","props","getPosts","postId","data","state","get","then","apiData","setState","concat","lastId","length","id","catch","console","log","onScrollHandle","clientHeight","document","documentElement","scrollHeight","scrollTop","isBottom","componentDidMount","window","addEventListener","componentWillUnmount","removeEventListener","render"],"mappings":";AAAA,OAAOA,MAAP,MAAmB,mBAAnB;AACA,OAAOC,IAAP,MAAiB,QAAjB;AACA,SAASC,SAAT,QAA0B,OAA1B;AACA,OAAOC,KAAP,MAAkB,OAAlB;;AAEA,MAAMC,SAAS,GAAGJ,MAAM,CAACK,GAAI;AAC7B;AACA;AACA;AACA,CAJA;KAAMD,S;;AAMN,MAAME,GAAN,SAAkBJ,SAAlB,CAA4B;AAC1BK,EAAAA,WAAW,CAACC,KAAD,EAAQ;AAAA;;AACjB,UAAMA,KAAN,CADiB;AAAA;;AAAA,SASnBC,QATmB,GASR,YAAiB;AAAA,UAAhBC,MAAgB,uEAAP,EAAO;AAC1B,YAAM;AAAEC,QAAAA;AAAF,UAAW,KAAI,CAACC,KAAtB;AAEAT,MAAAA,KAAK,CACFU,GADH,CACQ,sBAAqB,CAAC,CAACH,MAAF,GAAW,aAAaA,MAAxB,GAAiC,EAAG,EADjE,EAEGI,IAFH,CAEQ,QAAuB;AAAA,YAAtB;AAAEH,UAAAA,IAAI,EAAEI;AAAR,SAAsB;;AAC3B,QAAA,KAAI,CAACC,QAAL,CAAc;AACZL,UAAAA,IAAI,EAAEA,IAAI,CAACM,MAAL,CAAYF,OAAZ,CADM;AAEZG,UAAAA,MAAM,EAAEH,OAAO,CAACA,OAAO,CAACI,MAAR,GAAiB,CAAlB,CAAP,CAA4BC;AAFxB,SAAd;AAID,OAPH,EAQGC,KARH,CAQS,MAAM;AACXC,QAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ;AACD,OAVH;AAWD,KAvBkB;;AAAA,SAyBnBC,cAzBmB,GAyBF,MAAM;AACrB,YAAM;AAAEN,QAAAA;AAAF,UAAa,KAAKN,KAAxB;AACA,YAAMa,YAAY,GAAGC,QAAQ,CAACC,eAAT,CAAyBF,YAA9C;AACA,YAAMG,YAAY,GAAGF,QAAQ,CAACC,eAAT,CAAyBC,YAA9C;AACA,YAAMC,SAAS,GAAGH,QAAQ,CAACC,eAAT,CAAyBE,SAA3C;AACA,YAAMC,QAAQ,GAAGL,YAAY,GAAGI,SAAf,KAA6BD,YAA9C;;AAEA,UAAGE,QAAQ,IAAIZ,MAAf,EAAuB;AACrB,aAAKT,QAAL,CAAcS,MAAd;AACD;AACF,KAnCkB;;AAGjB,SAAKN,KAAL,GAAa;AACXD,MAAAA,IAAI,EAAE,EADK;AAEXO,MAAAA,MAAM,EAAE;AAFG,KAAb;AAID;;AA8BsB,QAAjBa,iBAAiB,GAAG;AACxBC,IAAAA,MAAM,CAACC,gBAAP,CAAwB,QAAxB,EAAkC,KAAKT,cAAvC;AAEA,UAAM,KAAKf,QAAL,EAAN;AACD;;AAEDyB,EAAAA,oBAAoB,GAAG;AACrBF,IAAAA,MAAM,CAACG,mBAAP,CAA2B,QAA3B,EAAqC,KAAKX,cAA1C;AACD;;AAEDY,EAAAA,MAAM,GAAG;AACP,UAAM;AAAEzB,MAAAA;AAAF,QAAW,KAAKC,KAAtB;AAEA,wBACE,QAAC,SAAD;AAAA,6BACE,QAAC,IAAD;AAAM,QAAA,IAAI,EAAED;AAAZ;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,YADF;AAKD;;AAxDyB;;AA2D5B,eAAeL,GAAf","sourcesContent":["import styled from 'styled-components';\nimport List from './List';\nimport { Component } from 'react';\nimport axios from 'axios';\n\nconst StyledApp = styled.div`\n  background-color: rgb(0, 50, 78);\n  min-height: 100vh;\n  padding: 50px;\n`;\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      data: [],\n      lastId: null\n    };\n  }\n\n  getPosts = (postId = '') => {\n    const { data } = this.state;\n\n    axios\n      .get(`/posts?popular=true${!!postId ? '&before=' + postId : ''}`)\n      .then(({ data: apiData }) => {\n        this.setState({\n          data: data.concat(apiData),\n          lastId: apiData[apiData.length - 1].id\n        });\n      })\n      .catch(() => {\n        console.log('fail');\n      });\n  };\n\n  onScrollHandle = () => {\n    const { lastId } = this.state;\n    const clientHeight = document.documentElement.clientHeight;\n    const scrollHeight = document.documentElement.scrollHeight;\n    const scrollTop = document.documentElement.scrollTop;\n    const isBottom = clientHeight + scrollTop === scrollHeight;\n\n    if(isBottom && lastId) {\n      this.getPosts(lastId)\n    }\n  };\n\n  async componentDidMount() {\n    window.addEventListener('scroll', this.onScrollHandle);\n\n    await this.getPosts();\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('scroll', this.onScrollHandle);\n  }\n\n  render() {\n    const { data } = this.state;\n\n    return (\n      <StyledApp>\n        <List data={data}></List>\n      </StyledApp>\n    );\n  }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}